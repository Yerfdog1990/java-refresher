
---

# ğŸ§  **Lesson Notes: Basic Spring Boot Security**

---

## **2.1. Spring Security Framework**

Spring Security is a **powerful and comprehensive framework** that provides **authentication** and **authorization** features for Spring applications.
It serves as a protective layer that secures both web and REST-based applications from common attacks such as:

* **Session Fixation**
* **Clickjacking**
* **Cross-Site Request Forgery (CSRF)**
* **Man-in-the-middle** and **brute-force** attacks (through encryption mechanisms)

Spring Security integrates seamlessly with the Spring ecosystem, allowing developers to apply declarative security at the **method**, **URL**, and **domain object** levels.

---

## **2.2. Adding Spring Security**

To secure a Spring Boot application, we simply add the **Spring Security starter** dependency to the projectâ€™s `pom.xml` file:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

Once added, Spring Boot **auto-configures** the security module and:

* Requires authentication for all endpoints by default.
* Provides a **default login form** or supports **HTTP Basic Authentication**.

### Example:

Running the application and navigating to
`http://localhost:8080/projects`
redirects users automatically to a **login page**, generated by Spring Security.

---

## **2.3. Spring Security Default Credentials**

When Spring Security is first added:

* A **default user** is automatically created.
* The **username** is `user`.
* The **password** is displayed in the console during startup.

You can override these defaults in `application.properties`:

```properties
spring.security.user.name=admin
spring.security.user.password=admin123
```

This setup is suitable for testing, but production applications require more robust configurations, such as using a database or external authentication provider.

---

## **2.4. Spring Security Configurations**

To customize security, we define a configuration class annotated with `@Configuration`.
Optionally, we include `@EnableWebSecurity` for clarity:

```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig {
    // security beans go here
}
```

This class allows us to:

* Specify **which endpoints** are secured or public.
* Define **login mechanisms** (form, OAuth2, JWT, etc.).
* Configure **users**, **password encoding**, and **roles**.

---

## **2.5. Basic Security Configuration**

The core configuration involves exposing a `SecurityFilterChain` bean that defines **how HTTP requests are secured**.

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http.authorizeHttpRequests((authorize) -> authorize
            .requestMatchers("/login*", "/*css/**").permitAll()
            .anyRequest().authenticated())
        .formLogin(withDefaults());
    return http.build();
}
```

### **Explanation:**

| Component                 | Description                                                       |
| ------------------------- | ----------------------------------------------------------------- |
| `HttpSecurity`            | A builder object that configures web-based security.              |
| `authorizeHttpRequests()` | Defines URL-based access rules.                                   |
| `requestMatchers()`       | Specifies which requests are public (no authentication required). |
| `formLogin()`             | Enables default form-based login.                                 |
| `http.build()`            | Constructs and returns a `SecurityFilterChain` object.            |

This setup allows unrestricted access to:

* `/login*`
* `/*css/**`

All other endpoints require user authentication.

---

## **2.6. Configuring Users**

To authenticate users, we define a `UserDetailsService` bean.
In this example, an **in-memory authentication** mechanism is used for simplicity:

```java
@Bean
public InMemoryUserDetailsManager userDetailsService(PasswordEncoder passwordEncoder) {
    UserDetails user = User.withUsername("user")
            .password(passwordEncoder.encode("password"))
            .roles("USER")
            .build();
    return new InMemoryUserDetailsManager(user);
}
```

### **Key Components:**

| Class                        | Role                                           |
| ---------------------------- | ---------------------------------------------- |
| `UserDetails`                | Represents a user (username, password, roles). |
| `InMemoryUserDetailsManager` | Stores user data in memory.                    |
| `PasswordEncoder`            | Encodes passwords securely.                    |

The user credentials (`user` / `password`) will now be required when accessing protected endpoints.

We must also define a password encoder:

```java
@Bean
public PasswordEncoder encoder() {
    return new BCryptPasswordEncoder();
}
```

### **Why Encode Passwords?**

Encoding prevents storing plaintext passwords.
`BCryptPasswordEncoder` adds **salt** and uses a **one-way hash**, protecting against rainbow table attacks.

---

## **2.7. Boot Highlight**

For **non-Spring Boot** applications, we add the dependencies manually:

```xml
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-web</artifactId>
    <version>...</version>
</dependency>
<dependency>
    <groupId>org.springframework.security</groupId>
    <artifactId>spring-security-config</artifactId>
    <version>...</version>
</dependency>
```

We must also register the `springSecurityFilterChain` filter manually:

```java
public class SecurityWebApplicationInitializer 
        extends AbstractSecurityWebApplicationInitializer { 
    public SecurityWebApplicationInitializer() { 
        super(WebSecurityConfig.class); 
    }
}
```

This ensures that all incoming web requests are intercepted and processed by Spring Security filters.

---

## **2.8. Spring Security Filter Chain (Extra)**

Spring Securityâ€™s web infrastructure is built on **Servlet filters**.

A **Servlet filter** intercepts HTTP requests before they reach the servlet and can modify, validate, or block them.

Spring Security integrates into this mechanism through:

```
DelegatingFilterProxy â†’ delegates to â†’ FilterChainProxy â†’ contains â†’ multiple security filters
```

### Internally:

1. The **DelegatingFilterProxy** connects the web container to Spring Security.
2. The **FilterChainProxy** contains a sequence of Spring-managed filters:

    * Authentication filters
    * CSRF protection
    * Session management
    * Exception handling filters

Each filter contributes to enforcing different parts of the security model.

---

## **2.9. The Security Context (Extra)**

Spring Security stores the authenticated userâ€™s details in a `SecurityContext` object.
This object is thread-bound using a `ThreadLocal` variable managed by the `SecurityContextHolder`.

Example:

```java
SecurityContext context = SecurityContextHolder.getContext();
Authentication authentication = context.getAuthentication();
String username = authentication.getName();
```

This allows any part of the application to retrieve the currently authenticated user.

---

## **2.10. Password Encoding (Extra)**

Spring Security encourages storing passwords in **hashed** form using strong algorithms such as BCrypt.

Example encoder:

```java
PasswordEncoder encoder = new BCryptPasswordEncoder();
String encoded = encoder.encode("password");
```

* **BCrypt** adds a **random salt** for each password.
* Prevents attackers from using precomputed hashes.
* Widely regarded as one of the most secure hashing mechanisms.

---

## **2.11. Boot 2 Notes (Legacy Configuration)**

Before Spring Boot 3 / Spring Security 6, configurations were done by extending `WebSecurityConfigurerAdapter`:

```java
@Configuration
@EnableWebSecurity
public class WebSecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests()
            .antMatchers("/login*").permitAll()
            .anyRequest().authenticated()
            .and().formLogin();
    }
}
```

To define users:

```java
@Override
protected void configure(AuthenticationManagerBuilder auth) throws Exception {
    UserDetails user = User.withDefaultPasswordEncoder()
        .username("user")
        .password("password")
        .roles("USER")
        .build();
    auth.inMemoryAuthentication().withUser(user);
}
```

Newer versions **removed** `WebSecurityConfigurerAdapter` in favor of the more flexible **bean-based** configuration using `SecurityFilterChain`.

---

## **2.12. Diagram: How Spring Security Works**

```plaintext
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              WebSecurityConfig Class               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
             Defines three beans:
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ SecurityFilterChain          â”‚  â†’ Configures HTTP security
             â”‚ InMemoryUserDetailsManager   â”‚  â†’ Stores user details
             â”‚ PasswordEncoder              â”‚  â†’ Encrypts passwords
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         Spring Security Filter Chain               â”‚
        â”‚ DelegatingFilterProxy â†’ FilterChainProxy           â”‚
        â”‚   â†³ Authentication Filter                          â”‚
        â”‚   â†³ CSRF Filter                                    â”‚
        â”‚   â†³ Session Management Filter                      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        Security Context (per request thread)       â”‚
        â”‚ SecurityContextHolder â†’ stores Authentication info â”‚
        â”‚ Accessible via getContext().getAuthentication()    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… **Summary**

| Concept                 | Purpose                                              |
| ----------------------- | ---------------------------------------------------- |
| **Spring Security**     | Framework for authentication & authorization.        |
| **SecurityFilterChain** | Defines how HTTP requests are secured.               |
| **HttpSecurity**        | Builder that configures request authorization rules. |
| **UserDetailsService**  | Loads user-specific data for authentication.         |
| **PasswordEncoder**     | Encrypts and verifies passwords securely.            |
| **SecurityContext**     | Holds authentication data of the current user.       |

---
