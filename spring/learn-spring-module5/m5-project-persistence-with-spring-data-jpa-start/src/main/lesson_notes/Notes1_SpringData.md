# üß© Lesson Notes: Persistence with Spring Data JPA

---

## üéØ Learning Goals

By the end of this lesson, learners should be able to:

* Understand what **Spring Data JPA** is and why it‚Äôs used.
* Differentiate between **`CrudRepository`** and **`JpaRepository`**.
* Implement a basic **JPA entity** and repository interface.
* Perform CRUD operations with Spring Boot.
* Explain why **no-args constructors** are required in JPA entities.

---

## 1. Overview of Persistence with Spring Data JPA

**Spring Data JPA** is part of the **Spring Data** family, designed to simplify data access using the Java Persistence API (JPA). It eliminates boilerplate code for DAO layers and provides powerful abstractions for working with databases.

Instead of writing SQL or implementing repository logic manually, developers can define **repository interfaces**, and Spring automatically provides implementations at runtime.

Example workflow:

1. Define your **entity class** (a table representation).
2. Define a **repository interface** (extending CrudRepository or JpaRepository).
3. Use Spring Boot to automatically handle database operations.

---

## 2. Setting Up Dependencies

Include the following in your `pom.xml` for Maven projects:

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>

<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

---

## 3. Creating an Entity

An entity is a Java class mapped to a database table using JPA annotations.

Example:

```java
import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDate;

@NoArgsConstructor
@AllArgsConstructor
@Getter
@Setter
@Entity
public class Project {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String name;
    private LocalDate dateCreated;
}
```

---

## 4. Why Do We Need a No-Args Constructor in JPA Entities?

In JPA, a **no-args constructor** is essential for several reasons:

1. **JPA Provider Requirement** ‚Äì The JPA specification mandates that all entity classes must have a no-args constructor (can be `protected` or package-private). JPA providers like Hibernate use reflection to instantiate entities.
2. **Proxy Generation** ‚Äì Providers often create proxy objects for **lazy loading**, which extend the entity class and rely on an accessible no-args constructor.
3. **Object Instantiation** ‚Äì During data retrieval, JPA needs to:

    * Instantiate entities without arguments.
    * Set fields directly.
    * Manage object state internally.
4. **Inheritance** ‚Äì In class hierarchies, a no-args constructor ensures proper subclass instantiation.

Example:

```java
@NoArgsConstructor  // Generated by Lombok
@AllArgsConstructor
@Getter
@Setter
@Entity
public class Project {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    private LocalDate dateCreated;
}
```

Without Lombok:

```java
protected Project() {
    // Required by JPA
}
```

The constructor can be **protected** or **public**, but **not private**.

---

## 5. Creating Repository Interfaces

Spring Data JPA provides two main interfaces for repositories:

### üîπ CrudRepository

* Basic CRUD (Create, Read, Update, Delete) operations.
* Simpler and lightweight.

Example:

```java
import org.springframework.data.repository.CrudRepository;

public interface ProjectRepository extends CrudRepository<Project, Long> {
}
```

### üîπ JpaRepository

* Extends `CrudRepository` and adds **JPA-specific features**.
* Provides **pagination, sorting**, and **batch operations**.

Example:

```java
import org.springframework.data.jpa.repository.JpaRepository;

public interface ProjectRepository extends JpaRepository<Project, Long> {
}
```

---

## 6. Comparison: `CrudRepository` vs `JpaRepository`

| Feature              | CrudRepository | JpaRepository                               |
| -------------------- | -------------- | ------------------------------------------- |
| Extends              | Repository     | PagingAndSortingRepository & CrudRepository |
| CRUD Methods         | ‚úÖ Yes          | ‚úÖ Yes                                       |
| Pagination & Sorting | ‚ö†Ô∏è Limited     | ‚úÖ Full Support                              |
| Batch Operations     | ‚ùå No           | ‚úÖ Yes                                       |
| Flush & SaveAndFlush | ‚ùå No           | ‚úÖ Yes                                       |
| Use Case             | Simple CRUD    | Full JPA operations (recommended)           |

**In practice:** Most developers prefer `JpaRepository` because it‚Äôs a superset of `CrudRepository` and integrates better with JPA features.

---

## 7. Testing with Spring Boot

Example: simple service test.

```java
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;

@Component
public class ProjectRunner implements CommandLineRunner {

    @Autowired
    private ProjectRepository projectRepository;

    @Override
    public void run(String... args) {
        Project project = new Project(null, "AI Assistant", LocalDate.now());
        projectRepository.save(project);
        System.out.println("Projects: " + projectRepository.findAll());
    }
}
```

---

## 8. Custom Queries

You can define methods based on naming conventions or use `@Query`.

Example:

```java
public interface ProjectRepository extends JpaRepository<Project, Long> {
    List<Project> findByNameContaining(String keyword);

    @Query("SELECT p FROM Project p WHERE p.dateCreated > :date")
    List<Project> findRecentProjects(@Param("date") LocalDate date);
}
```

---

## 9. Database Initialization

You can use `schema.sql` and `data.sql` in `src/main/resources` to pre-load tables and data.

Example:

**schema.sql**

```sql
CREATE TABLE project (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255),
    date_created DATE
);
```

**data.sql**

```sql
INSERT INTO project (name, date_created) VALUES ('Spring Boot Starter', '2025-01-01');
```

---

## 10. Summary Review

| Concept             | Key Point                                       |
| ------------------- | ----------------------------------------------- |
| Entity              | Represents a table in the database              |
| Repository          | Interface for performing CRUD operations        |
| CrudRepository      | Basic CRUD operations                           |
| JpaRepository       | Full JPA support (pagination, flush, etc.)      |
| No-Args Constructor | Required for reflection and proxy instantiation |

‚úÖ Teaching Tip: Have learners create a Task entity and repository using JpaRepository, then perform CRUD operations through a REST controller.
---
